---
title: "Project Applied Biostatistics"
author: "Santiago Anton Moreno"
date: "16/03/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidyverse)
library(caret)
library(leaps)
library(MASS)
```

````{r data,echo=FALSE}
#we get the data and format it nicely
path<-"apple1"
data <- read.csv(path, sep=",",header=TRUE)[,2:8]
colnames(data)<-c("variety","strain","days","weight","radius","radial","rate")
data<-transform(data,variety=as.factor(variety),strain=as.factor(strain))

head(data)
````
Data is nicely stored in our environement.

````{r exploratory analysis}
library(GGally)
par(mfrow=c(1,2))
boxplot(rate~strain,data = data)
boxplot(rate~variety,data = data)
ggpairs(data)

````
As we can see in those two plots the homoskedacity property is clearly violated thus we should be carefull when doing analysis. The strain factor seems to be more informative than the apple variety. Normality is also violated as we see that the boxplot for some strains or variety are clearly non symetric which suggest non-normality of the rate. Indepence should be preserved since the study was done cleanly.
````{r exploratory}
plot.design(data)
interaction.plot(data$variety,data$strain,data$rate)
````
````{r model fitting}
model.1=aov(rate~strain+variety,data=data[c(-15,-16),])
summary(model.1)
```
````{r model diagnostic}
layout(matrix(1:4,ncol=2))
plot(model.1)

```
````{r diagnostic}
model.full=aov(rate~strain+variety+radius+weight+days,data=data[c(-16,-15),])
step.model=stepAIC(model.full,direction="both",trace=FALSE)
summary(step.model)

````

````{r diag}
print(AIC(step.model))
print(AIC(model.1))
````
Well the aic betweenn the step model and the first naive model is not that different we can continue with our basic model.
```{r diag}
layout(matrix(1:4,ncol=2))
plot(model.1)
````
```{r depth}
#see the changes between factors
TukeyHSD(model.1)
````